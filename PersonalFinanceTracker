#include <iostream>
#include <string>
#include <map>
using namespace std;

// Structure to store each expense details
struct Expense {
    string date;
    string category;
    string description;
    double amount;
    Expense* next;  // Pointer to next expense (for Linked List)
};

// Class to manage all expenses
class ExpenseTracker {
private:
    Expense* head;  // Start of linked list
    map<string, double> categoryTotals;  // Hash map for category-wise totals
    
public:
    // Constructor - initialize empty tracker
    ExpenseTracker() {
        head = NULL;
    }
    
    // Function 1: Add new expense
    void addExpense(string date, string category, string description, double amount) {
        // Create new expense node
        Expense* newExpense = new Expense();
        newExpense->date = date;
        newExpense->category = category;
        newExpense->description = description;
        newExpense->amount = amount;
        newExpense->next = NULL;
        
        // Add to linked list at beginning
        if (head == NULL) {
            head = newExpense;
        } else {
            newExpense->next = head;
            head = newExpense;
        }
        
        // Update category totals using hash map
        categoryTotals[category] += amount;
        
        cout << "\nExpense added successfully!\n";
    }
    
    // Function 2: Display all expenses
    void displayAllExpenses() {
        if (head == NULL) {
            cout << "\nNo expenses recorded yet.\n";
            return;
        }
        
        cout << "\n========== ALL EXPENSES ==========\n";
        Expense* temp = head;
        int count = 1;
        
        while (temp != NULL) {
            cout << "\nExpense #" << count++ << endl;
            cout << "Date: " << temp->date << endl;
            cout << "Category: " << temp->category << endl;
            cout << "Description: " << temp->description << endl;
            cout << "Amount: Rs." << temp->amount << endl;
            cout << "-----------------------------------\n";
            temp = temp->next;
        }
    }
    
    // Function 3: Search expense by category
    void searchByCategory(string category) {
        if (head == NULL) {
            cout << "\nNo expenses found.\n";
            return;
        }
        
        cout << "\n===== Expenses in '" << category << "' =====\n";
        Expense* temp = head;
        bool found = false;
        
        while (temp != NULL) {
            if (temp->category == category) {
                cout << "\nDate: " << temp->date << endl;
                cout << "Description: " << temp->description << endl;
                cout << "Amount: Rs." << temp->amount << endl;
                cout << "----------------------------\n";
                found = true;
            }
            temp = temp->next;
        }
        
        if (!found) {
            cout << "No expenses found in this category.\n";
        }
    }
    
    // Function 4: Sort expenses by amount (Bubble Sort - simple)
    void sortByAmount() {
        if (head == NULL || head->next == NULL) {
            cout << "\nNot enough expenses to sort.\n";
            return;
        }
        
        // Bubble sort on linked list
        bool swapped;
        Expense* current;
        Expense* last = NULL;
        
        do {
            swapped = false;
            current = head;
            
            while (current->next != last) {
                if (current->amount > current->next->amount) {
                    // Swap data
                    swap(current->date, current->next->date);
                    swap(current->category, current->next->category);
                    swap(current->description, current->next->description);
                    swap(current->amount, current->next->amount);
                    swapped = true;
                }
                current = current->next;
            }
            last = current;
        } while (swapped);
        
        cout << "\nExpenses sorted by amount!\n";
        displayAllExpenses();
    }
    
    // Function 5: Show category-wise report (using hash map)
    void showCategoryReport() {
        if (categoryTotals.empty()) {
            cout << "\nNo expenses recorded yet.\n";
            return;
        }
        
        cout << "\n===== CATEGORY-WISE SPENDING REPORT =====\n\n";
        
        for (auto it = categoryTotals.begin(); it != categoryTotals.end(); it++) {
            cout << it->first << ": Rs." << it->second << endl;
        }
        cout << "\n=========================================\n";
    }
    
    // Function 6: Calculate total spending
    double getTotalSpending() {
        double total = 0;
        Expense* temp = head;
        
        while (temp != NULL) {
            total += temp->amount;
            temp = temp->next;
        }
        
        return total;
    }
    
    // Function 7: Find highest expense
    void findHighestExpense() {
        if (head == NULL) {
            cout << "\nNo expenses found.\n";
            return;
        }
        
        Expense* temp = head;
        Expense* highest = head;
        
        while (temp != NULL) {
            if (temp->amount > highest->amount) {
                highest = temp;
            }
            temp = temp->next;
        }
        
        cout << "\n===== HIGHEST EXPENSE =====\n";
        cout << "Date: " << highest->date << endl;
        cout << "Category: " << highest->category << endl;
        cout << "Description: " << highest->description << endl;
        cout << "Amount: Rs." << highest->amount << endl;
        cout << "===========================\n";
    }
    
    // Destructor - free memory
    ~ExpenseTracker() {
        Expense* temp;
        while (head != NULL) {
            temp = head;
            head = head->next;
            delete temp;
        }
    }
};

// Main function with menu
int main() {
    ExpenseTracker tracker;
    int choice;
    
    
    cout << "\n+----------------------------------------+\n";
    cout << "|  PERSONAL FINANCE EXPENSE TRACKER      |\n";
    cout << "+----------------------------------------+\n";

    do {
        cout << "\n========== MENU ==========\n";
        cout << "1. Add Expense\n";
        cout << "2. Display All Expenses\n";
        cout << "3. Search by Category\n";
        cout << "4. Sort by Amount\n";
        cout << "5. Category-wise Report\n";
        cout << "6. Total Spending\n";
        cout << "7. Highest Expense\n";
        cout << "0. Exit\n";
        cout << "==========================\n";
        cout << "Enter your choice: ";
        cin >> choice;
        
        switch (choice) {
            case 1: {
                string date, category, description;
                double amount;
                
                cout << "\nEnter Date (DD/MM/YYYY): ";
                cin >> date;
                cout << "Enter Category (Food/Travel/Bills/Shopping/Other): ";
                cin >> category;
                cin.ignore();  // Clear buffer
                cout << "Enter Description: ";
                getline(cin, description);
                cout << "Enter Amount: Rs.";
                cin >> amount;
                
                tracker.addExpense(date, category, description, amount);
                break;
            }
            
            case 2:
                tracker.displayAllExpenses();
                break;
            
            case 3: {
                string category;
                cout << "\nEnter Category to search: ";
                cin >> category;
                tracker.searchByCategory(category);
                break;
            }
            
            case 4:
                tracker.sortByAmount();
                break;
            
            case 5:
                tracker.showCategoryReport();
                break;
            
            case 6:
                cout << "\n Total Spending: Rs." << tracker.getTotalSpending() << endl;
                break;
            
            case 7:
                tracker.findHighestExpense();
                break;
            
            case 0:
                cout << "\n Thank you for using Expense Tracker!\n";
                break;
            
            default:
                cout << "\n Invalid choice! Please try again.\n";
        }
        
    } while (choice != 0);
    
    return 0;
}
